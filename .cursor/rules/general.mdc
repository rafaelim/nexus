---
alwaysApply: true
---

# Nexus - General Project Rules

## Project Overview
Nexus is a multi-domain home management application built with:
- **Backend**: FastAPI, PostgreSQL, SQLAlchemy Core, Alembic
- **Frontend**: SolidJS, TypeScript, Tailwind CSS v4, Vite
- **Architecture**: Clean architecture with domain-driven design

## Business Rules
Domain-specific business rules are documented in `.cursor/rules/`:
- `finance/expenses.mdc` - Expenses business rules
- `finance/transactions.mdc` - Transactions business rules
- `finance/notes.mdc` - Notes (monthly/yearly) business rules
- Additional rule files should follow the pattern: `{domain}/{service}.mdc`

When implementing or modifying features, always refer to and follow the relevant business rules file.

## Project Structure

### Backend
- `app/core/`: Core functionality (database, config, security)
- `app/api/v1/`: API route handlers (thin controllers)
- `app/domain/{domain}/`: Domain-specific code
  - `dto/`: Data Transfer Objects (Pydantic models)
  - `repositories/`: Data access layer (SQLAlchemy Core)
  - `services/`: Business logic layer
  - `validations/`: Validation functions
  - `controllers/`: Optional domain controllers
- `db/`: Database schema and migrations
- Pattern: DTO → Controller → Service → Repository

### Frontend
- `src/pages/{domain}/`: Domain-specific pages
- `src/pages/{domain}/components/`: Domain-specific components
- `src/components/`: Generic/shared components
- `src/services/{domain}/`: API service clients
- `src/shared/`: Shared utilities and stores

## Domain Organization
- Each domain (e.g., `finance`) is self-contained with its own DTOs, repositories, services
- Domain-specific components live in `pages/{domain}/components/`
- Domain-specific services live in `services/{domain}/`
- Generic components live in `components/`

## When Making Changes
1. **Backend**: Update DTOs, services, repositories, and API endpoints in that order
2. **Frontend**: Update services, then components/pages
3. **Database**: Create Alembic migrations for schema changes
4. **Validation**: Always validate user ownership and data constraints
5. **Error Handling**: Use appropriate HTTP status codes and descriptive messages
6. **Testing**: Consider edge cases (NULL values, boundary conditions, state transitions)
7. **Business Rules**: Always check and follow the relevant business rules file in `.cursor/rules/`

## Important Notes
- No authentication system (local-only app, uses hardcoded `DEFAULT_USER_ID`)
- Users table has `first_name` and `last_name`, no `hashed_password`
- Database runs in Docker, API and FE run manually
- Use `python3` (not `python`) for virtual environments
- Tailwind CSS v4 uses Vite plugin (no `tailwind.config.js` or `postcss.config.js`)
- Backend Makefile available: `make init-db`, `make migrate`, `make start`, `make dev`
